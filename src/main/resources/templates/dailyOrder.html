<!DOCTYPE html>
<html xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity6">
<div xmlns:th="http://www.thymeleaf.org" th:replace="~{/fragments/header :: header}"></div>
<body>
<th:block th:replace="~{/fragments/navbarTitle :: navbarTitle}"></th:block>
<nav th:replace="~{/fragments/navbarTitle :: navbar}"></nav>

</head>
	<body>
		<h2>Commandes du jour : </h2>
		<form th:action="@{/admin/dailyOrder}" method="post">
			<table class="table">
				<thead>
					<tr>
						<th scope="col">#</th>
						<th scope="col">Nom Client</th>
						<th scope="col">Heure de la commande</th>
						<th>
							<span sec:authorize="hasAuthority('manager')">
								<span scope="col">Table/À emporter</span>
							</span>	
						</th>
						<th scope="col">Statut</th>
						<th>
							<span sec:authorize="hasAuthority('manager')">
								<span scope="col">Payé</span>
							</span>	
						</th>
					</tr>
				</thead>
				<tbody>
					<th:block th:each="order, iterStat : ${orders}">
						<tr>
							<td th:text="${iterStat.index}"></td>
							<td th:text="${order.clientName}"></td>
							<td th:text="${order.timeSlot}"></td>
							<td>
								<span sec:authorize="hasAuthority('manager')">
									<span th:if="${order.tableNumber != -1}" th:text="'table ' + ${order.tableNumber}"></span>
									<span th:if="${order.tableNumber == -1}">Commande en ligne</span>
								</span>	
							</td>
							<td th:if="${order.status == 'ready'}">Commande prête</td>
							<td th:if="${order.status == 'waiting'}">Commande en attente</td>
							<td>
								<span sec:authorize="hasAuthority('manager')">
									<span th:if="${order.paid == true}">Payé</span>
									<span th:if="${order.paid == false}">Non Payé</td>
								</span>	
							</td>
						</tr>
						</tr>
							<td></td>
							<td colspan="3">
								<th:block th:each="line : ${order.lines}">
									<div th:text="${line.quantity} + ' * ' + ${line.product.name}"> </div>
								</th:block>
							</td>
							<td>
								<input th:attr="
										type=checkbox, class=btn-check, autocomplete=off,
										value=${order.status == 'ready' ? 'waiting' : 'ready'},
										name='order#'+ ${order.id} + '.status',
										id='order#'+ ${order.id} + '.status'">
								<label class="btn" th:attrappend="for='order#'+ ${order.id}  + '.status'">
									<i class="bi"
										th:classappend="${order.status == 'ready'} ? bi-square-fill : bi-square">
									</i>
								</label>
							</td>
							<td sec:authorize="hasAuthority('manager')">
								<input th:attr="
										type=checkbox, class=btn-check, autocomplete=off,
										value=!${order.paid},
										name='order#'+ ${order.id} + '.paid',
										id='order#'+ ${order.id} + '.paid'">
								<label class="btn" th:attrappend="for='order#'+ ${order.id} + '.paid'">
									<i class="bi"
										th:classappend="${order.paid} ? bi-square-fill : bi-square">
									</i>
								</label>
							</td>
						</tr>
					</th:block>
				</tbody>
			</table>
			<input type="submit" value="Submit">
		</form>
	</body>
</html>